# Redis Persistence

## persistence options

### RDB

- redis database
- 지정된 간격으로 데이터셋의 특정 시점 스냅샷을 생성

#### RDB 장점

- ex) 24시간 내에는 매 시간별 스냅샷 생성하고 30일 내에는 일별 스냅샷 생성
- 원거리 데이터 센터나 aws s3 같은 저장소에 단일 파일로 보관하기 용이함
- redis 의 부모 프로세스가 시점 분기만 하면 나머지 작업은 자식이 처리하기 때문에 성능을 극대화할 수 있음
- AOF 에 비해 큰 데이터셋을 더 빠르게 시작할 수 있음
- replica 구성 시, 다시 시작 또는 장애 조치 후 부분 재동기화를 지원함

#### RDB 단점

- 장애가 발생하면 스냅샷 간격동안 유실된 데이터는 복구 불가능
- 자식 프로세스가 자주 fork 하여 디스크에 저장해야 하므로 데이터셋 크기에 영향을 많이 받음 CPU 성능이 부족할 경우, redis client 서비스가 초 단위로 멈출 수 있음
- AOF도 fork가 필요하지만 어느 정도 조절이 가능

### AOF

- Append Only File
- 모든 write operation 을 디스크에 저장하고 서버 재시작 시 원본 데이터셋을 구성

#### AOF 장점

- 가장 안정성이 높음(fsync 옵션을 다양하게 선택 가능: 안함, 초당 수행, 쿼리당 수행)
- 최악의 이슈 상황(로그를 중간에 쓰다가 멈추거나..)에서도 redis-check-aof 도구로 해결 가능
- 용량이 너무 클 때에도 백그라운드 처리로 성능을 확보할 수 있음
  - 현재 사용중인 파일외에 별도의 파일을 생성하여 작업을 멈추지 않도록 함
  - 새 파일에 AOF 작업이 완료되면 두 파일을 교체하여 안정성을 유지함
- AOF 파일의 내용은 이해하기 쉬운 형태이며 쉽게 export 할 수 있음
- 실수로 FLUSHALL 명령어를 수행하더라도 즉시 서버를 중단하고 가장 최근 명령을 제거한 후 다시 시작하는 것 만으로 데이터셋을 복구할 수 있음

#### AOF 단점

- 

### No persistence

- 서버가 켜져있는동안에만 데이터셋을 유지

### RDB + AOF

- 두 가지 persistence 를 동시에 활성화할 수 있음
- AOF 가 가장 완전한 데이터셋을 보장하므로 재구성하는데에 사용

## RDB 와 AOF 간의 trade off

